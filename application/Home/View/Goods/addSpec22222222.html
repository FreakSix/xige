<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="__PUBLIC__/css/layui/css/layui.css"  media="all">
  <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
  <link rel="stylesheet" href="__PUBLIC__/css/amazeui.min.css" />
</head>
<body>
 
<div class="layui-row">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px; margin-left: 20px;">
      <h2>添加商品规格</h2>
    </fieldset>
    <form class="layui-form layui-form-pane">  
        <div class="layui-form-item">
            <label class="layui-form-label" style="width:200px;">请选择商品分类</label>
            <div class="layui-input-inline" style="width:500px;">
                <select id="product_type" name="product_type" lay-verify="required" lay-filter="changeProductTypeInfo" >
                    <option value="" checked="checked">全部分类</option>
                    <foreach name="productTypeInfo" item="v">
                    <if condition="$search['product_type'] == $v['id']">
                       <option value="{$v[id]}" selected="selected">{$v['type_name']}</option>
                    <else/>
                       <option value="{$v['id']}" >{$v['type_name']}</option>
                    </if>
                    </foreach>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="width:200px;">请选择商品名称</label>
            <div class="layui-input-inline" style="width:500px;">
                <select id="product" name="product" lay-verify="required" lay-search="" lay-filter="changeProduct">
                    <option value="">直接选择或搜索选择</option>
                    <foreach name="productInfo" item="v">
                        <if condition="$search['product'] == $v['id']">
                            <option value="{$v[id]}" selected="selected">{$v['type_name']}</option>
                        <else/>
                            <option value="{$v['id']}" >{$v['type_name']}</option>
                        </if>
                    </foreach>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="width:200px;">请选择商品型号</label>
            <div class="layui-input-inline" style="width:500px;">
                <select id="product_model" name="product_model" lay-verify="required" lay-search="" lay-filter="changeProductModel">
                    <option value="">直接选择或搜索选择</option>
                    <foreach name="productModelInfo" item="v">
                        <if condition="$search['product_model'] == $v['id']">
                            <option value="{$v[id]}" selected="selected">{$v['name']}</option>
                        <else/>
                            <option value="{$v['id']}" >{$v['name']}</option>
                        </if>
                    </foreach>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="width:200px;">请选择添加的规格类型</label>
            <div class="layui-input-inline" style="width:500px;">
                <select id="product_parameter" name="product_parameter"  lay-verify="required" lay-filter="changeProductParameter" >
                    <option value="" checked="checked">全部规格</option>
                    <foreach name="productParameterInfo" item="v">
                    <if condition="$search['product_parameter'] == $v['id']">
                       <option value="{$v[id]}" selected="selected">{$v['name']}</option>
                    <else/>
                       <option value="{$v['id']}" >{$v['name']}</option>
                    </if>
                    </foreach>
                </select>
            </div>
        </div>
      
        <div class="layui-form-item">
            <label class="layui-form-label" style="width:200px;">请输入规格</label>
            <div class="layui-input-inline" style="width:500px;">
                <input type="text" id="spec" name="spec" autocomplete="off"  lay-verify="required" placeholder="请输入规格" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block"> 
                <!-- <button class="layui-btn" lay-submit="" lay-filter="submit">立即提交</button> -->
                <button class="layui-btn" lay-filter="submit" id="submit" type="button">确认添加</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
      
     
     
        <!-- <div class="layui-form-item">
            <button class="layui-btn" lay-submit="" lay-filter="demo2">跳转式提交</button>
        </div> -->
    </form>


    




</div>

            
          
<script src="__PUBLIC__/css/layui/layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script src="__PUBLIC__/js/jquery.min.js"></script>

 <script type="text/javascript">
//     function addProductType(){
//         layui.use('layer', function(){
//           var layer = layui.layer;
          
//           layer.open({
//                 type: 2,
//                 offset: '20px',
//                 title: '添加联系人信息',
//                 area: ['700px', '450px'],
//                 // fixed: false, //不固定
//                 maxmin: true,
//                 content: '__APP__/Goods/addProductType',
//             });
//         }); 
        
//     }
// </script> 

<script>
layui.use(['form', 'layedit', 'laydate'], function(){
    var form = layui.form
    ,layer = layui.layer
    ,layedit = layui.layedit
    ,laydate = layui.laydate;
  
    form.on('select(changeProductTypeInfo)', function(data){

        layer.alert(667788);

        var type_id = $("#product_type").val();
        if(type_id == '0'){
            var type_id = 0;
        }else{
            var type_id = type_id;
        }
          
        $.ajax({
            url:'__APP__/Goods/getProductNames',
            data:'type_id='+type_id,
            type:'post',
            dataType:'json',
            success:function(re){
                var product_id = '';
                var product_name = '';

                $("#product").empty();
                $("#product").append("<option value=''>直接选择或搜索选择</option>"); 
                for (var k in re){
                    product_id = re[k].id;
                    product_name = re[k].type_name;
                    $("#product").append("<option value='"+product_id+"'>"+product_name+"</option>"); 
                }
                //重新加载商品型号
                $.ajax({
                    url:'__APP__/Goods/getProductModelAll',
                    data:'id= 0',
                    type:'post',
                    dataType:'json',
                    success:function(re){
                        var product_id = '';
                        var product_name = '';

                        $("#product_model").empty();
                        $("#product_model").append("<option value=''>直接选择或搜索选择</option>"); 
                        for (var k in re){
                            product_id = re[k].id;
                            product_name = re[k].name;
                            $("#product_model").append("<option value='"+product_id+"'>"+product_name+"</option>"); 
                        }
                        //重新加载商品规格
                        $.ajax({
                            url:'__APP__/Goods/getProductParameterAll',
                            data:'id= 0',
                            type:'post',
                            dataType:'json',
                            success:function(re){
                                var product_id = '';
                                var product_name = '';

                                $("#product_parameter").empty();
                                $("#product_parameter").append("<option value=''>直接选择或搜索选择</option>"); 
                                for (var k in re){
                                    product_id = re[k].id;
                                    product_name = re[k].name;
                                    $("#product_parameter").append("<option value='"+product_id+"'>"+product_name+"</option>"); 
                                }
                                layui.form.render('select')
                            }
                        });
                        // layui.form.render('select')
                    }
                });
                // layui.form.render('select')
            }
        });
    });
    

    form.on('select(changeProduct)', function(data){
        var id = $("#product").val();
        //重新渲染商品型号下拉选择框的内容
        $.ajax({
            url:'__APP__/Goods/getProductModel',
            data:'id='+id,
            type:'post',
            dataType:'json',
            success:function(re){
                var product_id = '';
                var product_name = '';

                $("#product_model").empty();
                $("#product_model").append("<option value=''>直接选择或搜索选择</option>"); 
                for (var k in re){
                    product_id = re[k].id;
                    product_name = re[k].name;
                    $("#product_model").append("<option value='"+product_id+"'>"+product_name+"</option>"); 
                }
                layui.form.render('select')
            }
        });
        //重新渲染商品规格下拉选择框的内容
        $.ajax({
            url:'__APP__/Goods/getProductParameter',
            data:'product_id='+id,
            type:'post',
            dataType:'json',
            success:function(re){
                var product_id = '';
                var product_name = '';

                $("#product_parameter").empty();
                $("#product_parameter").append("<option value=''>直接选择或搜索选择</option>"); 
                for (var k in re){
                    product_id = re[k].id;
                    product_name = re[k].name;
                    $("#product_parameter").append("<option value='"+product_id+"'>"+product_name+"</option>"); 
                }
                layui.form.render('select')
            }
        });
    });

    // $("#submit").click(function(){
    //     var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
    //     // layer.alert(JSON.stringify(data.field));
    //     // return false;

    //     var type_id = $("#product_type").val();
    //     var id = $("#product").val();
    //     var model_id = $("#product_model").val();
    //     var parameter_id = $("#product_parameter").val();
    //     var spec_value = $("#spec").val();

    //     if(type_id == ''){
    //         layer.msg('请选择商品分类！', {icon: 5});
    //         $("#product_type").focus();
    //         return false;
    //     }
    //     if(id == ''){
    //         layer.msg('请选择商品名称！', {icon: 5});
    //         $("#product").focus();
    //         return false;
    //     }
    //     if(model_id == ''){
    //         layer.msg('请选择商品型号！', {icon: 5});
    //         $("#product_model").focus();
    //         return false;
    //     }
    //     if(parameter_id == ''){
    //         layer.msg('请选择商品规格！', {icon: 5});
    //         $("#product_parameter").focus();
    //         return false;
    //     }
    //     if(spec_value == ''){
    //         layer.msg('请输入商品规格！', {icon: 5});
    //         $("#spec").focus();
    //         return false;
    //     }

    //     $.ajax({
    //         url:'__APP__/Goods/addProductSpec',
    //         type:'post',
    //         data:'type_id='+type_id+'&id='+id+'&model_id='+model_id+'&parameter_id='+parameter_id+'&spec_value='+spec_value,
    //         dataType:'json',
    //         success:function(re){
    //             // layer.msg(re, {icon: 1});
    //             parent.layer.alert('信息添加成功！', {
    //                                                         icon: 1,
    //                                                         offset: '200px',
    //                                                         title:'提示',
    //                                                     });
    //                     parent.layer.close(index);
    //         }
    //     });
    // });

    // form.on('submit(submit)', function(data){
    //     // console.log(data.elem) //被执行事件的元素DOM对象，一般为button对象
    //     // console.log(data.form) //被执行提交的form对象，一般在存在form标签时才会返回
    //     // console.log(data.field) //当前容器的全部表单字段，名值对形式：{name: value}
        

        
    // });

});
</script>

<script type="text/javascript">
    $(document).ready(function(){
        $("#submit").click(function(){
            var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
            // layer.alert(JSON.stringify(data.field));
            // return false;

            var type_id = $("#product_type").val();
            var id = $("#product").val();
            var model_id = $("#product_model").val();
            var parameter_id = $("#product_parameter").val();
            var spec_value = $("#spec").val();

            if(type_id == ''){
                layer.msg('请选择商品分类！', {icon: 5});
                $("#product_type").focus();
                return false;
            }
            if(id == ''){
                layer.msg('请选择商品名称！', {icon: 5});
                $("#product").focus();
                return false;
            }
            if(model_id == ''){
                layer.msg('请选择商品型号！', {icon: 5});
                $("#product_model").focus();
                return false;
            }
            if(parameter_id == ''){
                layer.msg('请选择商品规格！', {icon: 5});
                $("#product_parameter").focus();
                return false;
            }
            if(spec_value == ''){
                layer.msg('请输入商品规格！', {icon: 5});
                $("#spec").focus();
                return false;
            }

            $.ajax({
                url:'__APP__/Goods/addProductSpec',
                type:'post',
                data:'type_id='+type_id+'&id='+id+'&model_id='+model_id+'&parameter_id='+parameter_id+'&spec_value='+spec_value,
                dataType:'json',
                success:function(res){
                    // layer.msg(re, {icon: 1});
                    layer.msg('请输入商品规格！', {icon: 5});
                    parent.layer.alert('信息添加成功！', {
                                                                icon: 1,
                                                                offset: '200px',
                                                                title:'提示',
                                                            });
                            parent.layer.close(index);
                }
            });
        });
    });
</script>


</body>
</html>