<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="__PUBLIC__/css/layui/css/layui.css"  media="all">
  <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
  <link rel="stylesheet" href="__PUBLIC__/css/amazeui.min.css" />
  <link rel="stylesheet" href="__PUBLIC__/css/admin.css">
  <link rel="stylesheet" href="__PUBLIC__/css/app.css" />
  <!-- <link rel="stylesheet" href="__PUBLIC__/css/jquery-editable-select.css" /> -->
</head>
<body class="abc">
    <!-- 网站头部 -->
    <header class="am-topbar am-topbar-inverse admin-header">
        <include file="Public:header"/>
    </header>
    <div class="tpl-page-container tpl-page-header-fixed">
        <!-- 左侧菜单栏 -->
        <div class="tpl-left-nav tpl-left-nav-hover" nav="">
            <include file="Public:menu"/>
        </div>
        <!-- 右侧主要内容 -->
        <div class="tpl-content-wrapper">
            <!-- <div class="layui-tab layui-tab-card"> -->
                <!-- <div class="layui-tab-content" style="height: 100px;"> -->

                    <div class="layui-row">
                        <form class="layui-form" action="">
                            <div class="layui-form-item">

                                <div class="layui-inline">
                                    <div class="layui-input-inline">
                                        <button type="button" class="layui-btn layui-btn-warm" style="margin-top: 10px;margin-left: 5px;" onClick='addProductSpec()'>添加商品报价</button> 
                                    </div>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <div class="layui-inline" style="margin-top:10px;margin-left:50px;">
                                    <label class="layui-form-label" style="width:100px;">商品分类</label> 
                                    <div class="layui-input-inline" style="width:500px;margin-left:50px;">
                                        <select id="product_type" name="product_type" lay-search="" lay-filter="changeProductTypeInfo" >
                                            <option value="" checked="checked">全部分类</option>
                                            <foreach name="productTypeInfo" item="v">
                                               <option value="{$v['id']}" >{$v['type_name']}</option>
                                            </foreach>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline" style="margin-top:5px;margin-left:50px;">
                                    <label class="layui-form-label" style="width:100px;">商品名称:</label>
                                    <div class="layui-input-inline" style="width:500px;margin-left:50px;">
                                        <select id="product" name="product" lay-verify="required" lay-search="" lay-filter="changeProduct">
                                            <option value="">直接选择或搜索选择</option>
                                            <foreach name="productInfo" item="v">
                                                    <option value="{$v['id']}" >{$v['type_name']}</option>
                                            </foreach>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <!-- <div class="layui-form-item"> 
                                <div class="layui-inline" style="margin-top:5px;margin-left:50px;">
                                    <label class="layui-form-label" style="width:100px;">商品型号:</label>
                                    <div class="layui-input-inline" style="width:500px;margin-left:50px;">
                                        <select id="product_model" name="product_model" lay-verify="required" lay-search="" lay-filter="changeProductModel">
                                            <option value="">直接选择或搜索选择</option>
                                            <foreach name="productModelInfo" item="v">
                                                <option value="{$v['id']}" >{$v['name']}</option>
                                            </foreach>
                                        </select>
                                    </div>
                                </div>
                            </div> -->
                            <div class="layui-form-item" style="margin-top:5px;margin-left:50px;">
                                <label class="layui-form-label" style="width:100px;margin-right:50px;">商品型号:</label>
                                <div class="layui-input-block" id="product_model">
                                    <!-- <input type="radio" name="sex" value="男" title="男" checked="">
                                    <input type="radio" name="sex" value="女" title="女"> -->
                                    <!-- <foreach name="productModelInfo" item="v">
                                        <input type="radio"  lay-filter="productModelRadio" name="product_model" value="{$v['id']}" title="{$v['name']}">
                                    </foreach> -->
                                    <span id="sname_notice" style="color:#FF0000;font-size:16px;"> 请先选择商品分类和商品名称</span> 
                                </div>
                            </div>
                            <div id="product_parameter" lay-filter="product_parameter" class="layui-form-item" style="margin-top:5px;margin-left:50px;">
                                
                                <div class="layui-input-block" id="product_spec" lay-filter="product_spec" >
                                    
                                </div>
                            </div>
                            <div class="layui-form-item" style="margin-top:5px;margin-left:50px;">
                                <label class="layui-form-label" style="width:100px;margin-right:50px;">商品型号:</label>
                                <div class="layui-input-block" id="product_model">
                                    <foreach name="productModelInfo" item="v">
                                        <input type="radio"  lay-filter="productModelRadio" name="product_model" value="{$v['id']}" title="{$v['name']}">
                                    </foreach>
                                </div>
                            </div>

                        </form>

                    </div>


                    
                    
                <!-- </div> -->
            <!-- </div> -->
        </div>
    </div>
            
          
<script src="__PUBLIC__/css/layui/layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script src="__PUBLIC__/js/jquery.min.js"></script>
<script src="__PUBLIC__/js/amazeui.min.js"></script>
<script src="__PUBLIC__/js/app.js"></script>
<script src="__PUBLIC__/js/plus.js"></script>
<!-- <script src="__PUBLIC__/js/jquery-editable-select.js"></script> -->

<script>
layui.use(['form', 'layedit', 'laydate'], function(){
    var form = layui.form
    ,layer = layui.layer
    ,layedit = layui.layedit
    ,laydate = layui.laydate;
  
    //产品分类选择
    form.on('select(changeProductTypeInfo)', function(data){

        var type_id = $("#product_type").val();
        if(type_id == '0'){
            var type_id = 0;
        }else{
            var type_id = type_id;
        }
          
        $.ajax({
            url:'__APP__/Goods/getProductNames',
            data:'type_id='+type_id,
            type:'post',
            dataType:'json',
            success:function(re){
                var product_id = '';
                var product_name = '';

                $("#product").empty();
                $("#product").append("<option value=''>直接选择或搜索选择</option>"); 
                for (var k in re){
                    product_id = re[k].id;
                    product_name = re[k].type_name;
                    $("#product").append("<option value='"+product_id+"'>"+product_name+"</option>"); 
                }
                // //重新加载商品型号
                // $.ajax({
                //     url:'__APP__/Goods/getProductModelAll',
                //     data:'id= 0',
                //     type:'post',
                //     dataType:'json',
                //     success:function(re){
                //         var product_id = '';
                //         var product_name = '';

                //         $("#product_model").empty();
                //         $("#product_model").append("<option value=''>直接选择或搜索选择</option>"); 
                //         for (var k in re){
                //             product_id = re[k].id;
                //             product_name = re[k].name;
                //             $("#product_model").append("<option value='"+product_id+"'>"+product_name+"</option>"); 
                //         }
                //         // //重新加载商品规格
                //         // $.ajax({
                //         //     url:'__APP__/Goods/getProductParameterAll',
                //         //     data:'id= 0',
                //         //     type:'post',
                //         //     dataType:'json',
                //         //     success:function(re){
                //         //         var product_id = '';
                //         //         var product_name = '';

                //         //         $("#product_parameter").empty();
                //         //         $("#product_parameter").append("<option value=''>直接选择或搜索选择</option>"); 
                //         //         for (var k in re){
                //         //             product_id = re[k].id;
                //         //             product_name = re[k].name;
                //         //             $("#product_parameter").append("<option value='"+product_id+"'>"+product_name+"</option>"); 
                //         //         }
                //         //         layui.form.render('select')
                //         //     }
                //         // });
                //         // layui.form.render('select', 'changeProductModel')
                //     }
                // });
                layui.form.render('select');
                // layui.form.render('select', 'changeProductModel');
            }
        });
    });

    //选择产品名称时重新加载商品型号
    form.on('select(changeProduct)', function(data){
        var id = $("#product").val();
        //重新渲染商品型号下拉选择框的内容
        $.ajax({
            url:'__APP__/Goods/getProductModel',
            data:'id='+id,
            type:'post',
            dataType:'json',
            success:function(re){
                var product_id = '';
                var product_name = '';

                $("#product_model").empty();
                for (var k in re){
                    product_id = re[k].id;
                    product_name = re[k].name;
                    // $("#product_model").append("<input type='radio' name='product_model' value='"+product_id+"' title='"+product_name+"'>";
                    var html = "<input type='radio' lay-filter='productModelRadio' name='product_model' value='"+product_id+"' title='"+product_name+"' >";
                    $("#product_model").append(html);
                }
                layui.form.render('radio')
            }
        });
    });

    form.on('radio(productModelRadio)', function(data){
        console.log(data.elem); //得到radio原始DOM对象
        console.log(data.value); //被点击的radio的value值
        var model_id = data.value;
        var type_id = $("#product_type").val();
        var product_id = $("#product").val();

        if(product_id == ''){
                layer.msg('请先选择商品！', {icon: 5});
                $("#product_type").focus();
                return false;
            }
        if(model_id == ''){
                layer.msg('请先选择商品型号！', {icon: 5});
                $("#product_type").focus();
                return false;
            }
        // alert(product_id);exit;

        $.ajax({
            url:'__APP__/Goods/getProductSpecInfos',
            data:'model_id='+model_id+'&product_id='+product_id,
            type:'post',
            dataType:'json',
            success:function(re){
                var parameter_id = '';
                var parameter_name = '';
                var spec_id = '';
                var spec_value = '';

                // $("#product_spec").empty();
                for (var k in re){
                    parameter_id = re[k].id;
                    parameter_name = re[k].name;
                    var parameter_html = "<label class='layui-form-label' style='width:100px;margin-right:50px;'>"+parameter_name+":</label>";
                    $("#product_parameter").append('fasfsa');

                    // var html = "<input type='radio' lay-filter='productModelRadio' name='product_model' value='"+product_id+"' title='"+product_name+"' >";
                    // $("#product_model").append(html);
                }
                layui.form.render(null, 'product_parameter')
                // return false;

                // <div class="layui-form-item" style="margin-top:5px;margin-left:50px;">
                //     <label class="layui-form-label" style="width:100px;margin-right:50px;">商品型号:</label>
                //     <div class="layui-input-block" id="product_model">
                //         <foreach name="productModelInfo" item="v">
                //             <input type="radio"  lay-filter="productModelRadio" name="product_model" value="{$v['id']}" title="{$v['name']}">
                //         </foreach>
                //     </div>
                // </div>

            }
        });


    }); 

    

});
</script>

</body>
</html>