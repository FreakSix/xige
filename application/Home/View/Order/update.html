<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>新建订单-细格订单管理系统</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="__PUBLIC__/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="__PUBLIC__/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="__PUBLIC__/css/amazeui.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/css/admin.css">
    <link rel="stylesheet" href="__PUBLIC__/css/app.css">
    <style>
    </style>
</head>

<body data-type="generalComponents">
    <div class="tpl-portlet-components">
        <div class="tpl-block ">
            <div class="am-g tpl-amazeui-form">
                <div class="am-u-sm-12 am-u-md-12">
                    <form class="am-form am-form-horizontal">
                        <!-- 公司信息 -->
                        <h5>客户信息</h5>
                        <div class="am-form-group">
                            <label class="am-u-sm-2 am-form-label">客户名称：</label>
                            <div class="am-u-sm-5">
                                {$orderInfo['customer_name']}
                            </div>
                            <label for="user-name" class="am-u-sm-2 am-form-label">交货日期：</label>
                            <div class="am-u-sm-3">
                                <input type="text" id="trade_time" class="am-form-field" value="{$orderInfo['trade_time_value']}" data-am-datepicker readonly required />
                            </div>
                        </div>
                        <div class="am-form-group"> 
                            <label class="am-u-sm-2 am-form-label">联系人：</label>
                            <div class="am-u-sm-5">
                                <select id="linkman_name">
                                    <foreach name="customerLinkManInfo" item="v" key="k">
                                        <if condition="$orderInfo['linkman_name'] == $v['name']">
                                            <option value="{$v['id']}" selected="selected" onclick="getLinkmanPhone({$v['id']})" >{$v['name']}</option>
                                        <else/>
                                            <option value="{$v['id']}" onclick="getLinkmanPhone({$v['id']})" >{$v['name']}</option>
                                        </if>
                                    </foreach>
                                </select>
                            </div>
                            <label class="am-u-sm-2 am-form-label">联系电话：</label>
                            <div class="am-u-sm-3">
                                <input type="text" id="linkman_phone" value="{$orderInfo['linkman_tel']}">
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label class="am-u-sm-2 am-form-label">收货地址：</label>
                            <div class="am-u-sm-10">
                                <input type="text" id="link_address" value="{$orderInfo['link_address']}">
                            </div>
                        </div>
                        <hr/>
                        <!-- 联系人信息 -->
                        <h5>商品信息</h5>
                        <div class="am-form-group">
                            <label for="contact-name" class="am-u-sm-2 am-form-label">产品分类：</label>
                            <div class="am-u-sm-2">
                                {$orderInfo['product_type']}
                            </div>
                            <label for="contact-name" class="am-u-sm-2 am-form-label">产品名称：</label>
                            <div class="am-u-sm-2">
                                {$orderInfo['product_name']}
                            </div>
                            <label for="contact-name" class="am-u-sm-2 am-form-label">产品型号：</label>
                            <div class="am-u-sm-2">
                                {$orderInfo['product_model']}
                            </div>
                        </div>
                        <if condition="$orderInfo['parameter_spec_value'] != '' ">
                            <foreach name="orderInfo['parameter_spec_value']" item="v" key="k">
                                <div class="am-form-group">
                                    <label class="am-u-sm-2 am-form-label">{$v['parameter_name']}：</label>
                                    <div class="am-u-sm-10">
                                        {$v['spec_value']}
                                    </div>
                                </div>
                            </foreach> 
                        <else/>
                            <div class="am-form-group">
                                <label class="am-u-sm-2 am-form-label">产品规格：</label>
                                <div class="am-u-sm-10">
                                    该订单中无产品规格信息！
                                </div>
                            </div>
                        </if>

                        <if condition="$orderInfo['special_technology_value'] != null ">
                            <div class="am-form-group">
                                <label class="am-u-sm-2 am-form-label">特殊工艺：</label>
                                <div class="am-u-sm-10">
                                    {$orderInfo['special_technology_value']}
                                </div>
                            </div>
                        </if>
                        
                        <div class="am-form-group">
                            
                        </div>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">供应商：</label>
                            <div class="am-u-sm-10">
                                {$orderInfo['supplier_name']}
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">数量：</label>
                            <div class="am-u-sm-10">
                                {$orderInfo['num']}
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">成本单价：</label>
                            <div class="am-u-sm-10">
                                {$orderInfo['cost_price']} 元
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">成本总价：</label>
                            <div class="am-u-sm-2 am-u-end">
                                <input type="text" id="cost_money" value="{$orderInfo['cost_money']}" >
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">参考价格：</label>
                            <div class="am-u-sm-2 am-u-end">
                                {$orderInfo['discount_money']} 元
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">最终价格：</label>
                            <div class="am-u-sm-2 am-u-end">
                                <input type="text" id="end_money" value="{$orderInfo['end_money']}" >
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">素材链接：</label>
                            <div class="am-u-sm-10">
                                <input type="text" id="material_link" value="{$orderInfo['material_link']}">
                            </div>
                        </div>


                        <hr/>
                        <!-- 订单状态 -->
                        <h6>订单状态</h6>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">客户付款状态：</label>
                            <div class="am-u-sm-4">
                                <select id="money_status">
                                    <foreach name="moneyStatusArr" item="v" key="k">
                                        <if condition="$orderInfo['money_status'] == $v">
                                            <option value="{$v}" selected="selected">{$k}</option>
                                        <else/>
                                            <option value="{$v}" >{$k}</option>
                                        </if>
                                    </foreach>
                                </select>
                            </div>
                            <label for="contact-department" class="am-u-sm-2 am-form-label">客户付款总额：</label>
                            <div class="am-u-sm-4">
                                <input type="text" id="customer_money" value="{$orderInfo['customer_money']}">
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">订单状态：</label>
                            <div class="am-u-sm-4">
                                <select id="order_status">
                                    <foreach name="orderStatusArr" item="v" key="k">
                                        <if condition="$orderInfo['order_status'] == $v">
                                            <option value="{$v}" selected="selected">{$k}</option>
                                        <else/>
                                            <option value="{$v}" >{$k}</option>
                                        </if>
                                    </foreach>
                                </select>
                            </div>
                            <label for="contact-department" class="am-u-sm-2 am-form-label">向供应商付款总额：</label>
                            <div class="am-u-sm-4">
                                <input type="text" id="supplier_money" value="{$orderInfo['supplier_money']}" >
                            </div>
                        </div>

                        <input type="hidden" value="{$orderInfo['id']}" id="order_id" /> 

                        <hr/>
                        <div class="am-form-group">
                            <div class="am-u-sm-10 am-u-sm-push-2">
                                <button type="button" class="am-btn am-btn-primary" onclick="updateSubmit()">确认修改</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="__PUBLIC__/js/jquery.min.js"></script>
    <script src="__PUBLIC__/js/amazeui.min.js"></script>
    <script src="__PUBLIC__/js/app.js"></script>
    <script src="__PUBLIC__/js/plus.js"></script>
    <script src="__PUBLIC__/js/layer.js"></script>
    <script type="text/javascript">
        $(function(){
            $(".xg-product-btn").click(function(){
                $(this).addClass("xg-product-btn-selected")
                .siblings()
                .removeClass("xg-product-btn-selected");
            })
        })

        function getLinkmanPhone(id){
            alert(id);
            $.post("__APP__/Order/getTelByLxrId",{"lxr_id":id},function(res){
                var data = eval("(" + res + ")");
                $("#linkman_phone").val(data.phone);
                $("#link_address").val(data.address);
            })
        }

        function updateSubmit(){
            // alert(55555);
            var trade_time = $("#trade_time").val();
            var linkman_name = $("#linkman_name").val();
            var linkman_phone = $.trim($("#linkman_phone").val());
            if(linkman_phone == ''){
                layer.alert("联系人电话不能为空！", {icon: 5,offset: '200px',});
                $("#linkman_phone").focus();
                return false;
            }

            var link_address = $.trim($("#link_address").val());
            if(link_address == ''){
                layer.alert("联系人地址不能为空！", {icon: 5,offset: '200px',});
                $("#link_address").focus();
                return false;
            }

            var cost_money = $.trim($("#cost_money").val());
            if(cost_money == ''){
                layer.alert("成本总价不能为空！", {icon: 5,offset: '200px',});
                $("#cost_money").focus();
                return false;
            }

            var end_money = $.trim($("#end_money").val());
            if(end_money == ''){
                layer.alert("最总价格不能为空！", {icon: 5,offset: '200px',});
                $("#end_money").focus();
                return false;
            }

            var material_link = $("#material_link").val();
            var money_status = $("#money_status").val();
            var customer_money = $("#customer_money").val();
            var order_status = $("#order_status").val();
            var supplier_money = $("#supplier_money").val();

            var order_id = $("#order_id").val();

            //添加订单信息
            $.post("__APP__/Order/update",{"order_id":order_id,"trade_time":trade_time,"linkman_name":linkman_name,"linkman_phone":linkman_phone,"link_address":link_address,"cost_money":cost_money,"end_money":end_money,"material_link":material_link,"money_status":money_status,"customer_money":customer_money,"order_status":order_status,"supplier_money":supplier_money},function(res){
                    if(res > 0 ){
                        parent.layer.msg('修改成功！', {
                                                            icon: 1,
                                                            offset: '200px',
                                                            title:'提示',
                                                        });
                        parent.location.href='__APP__/Order/index';

                        var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                        parent.layer.close(index);

                    }else{
                        parent.layer.alert('修改失败！', {
                                                            icon: 5,
                                                            offset: '200px',
                                                            title:'提示',
                                                        });
                        return false;
                    }
            });

        }

    </script>
</body>

</html>