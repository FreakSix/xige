<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>新增报价记录</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="__PUBLIC__/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="__PUBLIC__/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="__PUBLIC__/css/amazeui.min.css" />
    <link rel="stylesheet" href="__PUBLIC__/css/admin.css">
    <link rel="stylesheet" href="__PUBLIC__/css/app.css">
    <style>
        h4 { margin: .5rem 0; }
        hr { margin: 0; }
        .xg-quote-customer { position: relative; }
    </style>
</head>
<body data-type="generalComponents">
    <div class="tpl-portlet-components">
        <div class="tpl-block ">
            <div class="am-g tpl-amazeui-form">
                <div class="am-u-sm-12">
                    <form class="am-form am-form-horizontal">
                        <!-- 公司信息 -->
                        <h4>客户信息</h4>
                        <div class="am-form-group">
                            <label class="am-u-sm-2 am-form-label">客户名称：</label>
                            <div class="am-u-sm-4 xg-quote-customer">
                                <!-- <div class="xg-search-input"> -->
                                    <input style=" " type="text" value="" id="customer_name" onkeyup="finds()">
                                <!-- </div> -->
                                <div class="xg-search-menu">
                                    <ul class="searchmore" id="searchmore">
                                    </ul>
                                </div>
                            </div>
                            

                            <label for="user-name" class="am-u-sm-2 am-form-label">客户等级：</label>
                            <div class="am-u-sm-2 am-u-end" id="customer_level_div">
                                <select id="customer_level_discount">
                                    <option value="">请选择客户等级</option>
                                    <if condition="$customerLevelInfo != ''">
                                        <foreach name="customerLevelInfo" item="item" key="key">
                                            <option value="{$item.id}">{$item.name}</option>
                                        </foreach>
                                    </if>
                                </select>
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label class="am-u-sm-2 am-form-label">联系人：</label>
                            <div class="am-u-sm-4" id="linkman_name_div">
                                <input type="text" id="linkman_name" value="">
                            </div>
                            <label class="am-u-sm-2 am-form-label">联系电话：</label>
                            <div class="am-u-sm-2 am-u-end">
                                <input type="text" id="linkman_phone" value="">
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label class="am-u-sm-2 am-form-label">备注：</label>
                            <div class="am-u-sm-8 am-u-end">
                                <input type="text" id="remark" value="">
                            </div>
                        </div>
                        <hr/>
                        <!-- 联系人信息 -->
                        <h4>商品信息</h4>
                        <div class="am-form-group">
                            <label for="contact-name" class="am-u-sm-2 am-form-label">服务类型：</label>
                            <div class="am-u-sm-2" >
                                <select id="product_type" name="product_type" onchange="getProductName()" data-am-selected="{btnWidth:'100%',maxHeight: 370,searchBox: 1}" >
                                    <option value="0" checked="checked">全部服务</option>
                                    <if condition="$productTypeInfo != ''">
                                        <foreach name="productTypeInfo" item="v">
                                            <option value="{$v['id']}" >{$v['type_name']}</option>
                                        </foreach>
                                    </if>
                                </select>

                                <!-- 在循环一次产品服务，把下拉框中需要的值放在隐藏域中 -->
                                <input type="hidden" value="0" id="hide_item_have_price_0" />
                                <if condition="$productTypeInfo != ''">
                                    <foreach name="productTypeInfo" item="v">
                                        <input type="hidden" value="{$v.have_price}" id="hide_item_have_price_{$v.id}" />
                                    </foreach>
                                </if>


                                <input type="hidden" value="" id="hide_have_price_value_2" />

                            </div>
                            <label for="contact-name" class="am-u-sm-2 am-form-label">产品名称：</label>
                            <div class="am-u-sm-4 am-u-end">
                                <select id="product_name" data-am-selected="{btnWidth:'100%',maxHeight: 370,searchBox: 1}" onchange="getProductModel()">
                                    <option value="0" checked="checked">请选择产品名称</option>
                                    <if condition="$productNameInfo != ''">
                                        <foreach name="productNameInfo" item="item" key="key">
                                            <option value="{$item.id}">{$item.type_name}</option>
                                        </foreach>
                                    </if>
                                </select>
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="contact-wechat" class="am-u-sm-2 am-form-label">产品型号：</label>
                            <div class="am-u-sm-8 am-u-end">
                                <ul id="product_model">
                                    <span style="color: #f00;">请先选择产品！</span>
                                </ul>
                            </div>
                            <input type="hidden" value="" id="hide_product_model_value" />
                        </div>
                        <div class="product_paramerter">
                            <div class="am-form-group">
                                <label for="contact-department" class="am-u-sm-2 am-form-label">产品规格：</label>
                                <div class="am-u-sm-8 am-u-end">
                                    <ul>
                                        <li class="" value="1">
                                            <span style="color: #f00;">请先选择产品型号！</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            
                            <input type="hidden" value="" id="post_parameter_spec_value" />

                        </div>
                        <div class="am-form-group" id="product_special_technology_div">

                        </div>

                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">供应商：</label>
                            <div class="am-u-sm-1">
                                <button type="button" class="am-btn am-btn-default" id="selectSupplier" onclick="selectSupplier()">选择供应商</button>
                            </div>
                            <div class="am-u-sm-9"  id="product_supplier_select" >
                                <span style="color: #f00;margin-left:20px;">请先选择产品信息！</span>
                                <input type='hidden' value='' id='select_supplier_id' />
                                <input type='hidden' value='' id='select_supplier_name' /> 
                                <input type='hidden' value='' id='product_cost_price' /> 
                            </div>
                            

                            <input type="hidden" value="{$productNameFirst['0'][id]}" id="hide_product_name_id" />
                        
                        </div>
                        <div class="am-form-group" id="select_supplier_group">

                        </div>

                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">数量：</label>
                            <div class="am-u-sm-2 am-u-end" id="product_num_div">
                                <input type="text" name="product_num" class="product_num" onclick="inputProductNum()" value="1">
                            </div>
                        </div>
                        <div class="am-form-group" id="order_refer_info_button">
                             <label for="contact-department" class="am-u-sm-2 am-form-label">参考信息：</label>
                            <div class="am-u-sm-10">
                                <button type="button"  onclick="getOrderReferInfo()" class="am-btn am-btn-default">查看</button>
                            </div>

                        </div>
                        <div class="am-form-group">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">参考总价：</label>
                            <div class="am-u-sm-2">
                                <button type="button"  onclick="getOrderReferInfoMoney()" class="am-btn am-btn-default">查看</button>
                            </div>
                            <div class="am-u-sm-8" id="order_refer_info_money_button">
                                <input type="hidden" value="" id="hide_product_discount_money" />
                            </div>
                        </div>
                        <div class="am-form-group" id="end_price_div">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">单价：</label>
                            <div class="am-u-sm-2 am-u-end" id="end_product_price_div">
                                <input type="text" name="end_product_price" id="end_product_price" class="end_product_price" value=''   >
                            </div>
                        </div>
                        <div class="am-form-group" id="end_price_div">
                            <label for="contact-department" class="am-u-sm-2 am-form-label">总报价：</label>
                            <div class="am-u-sm-2 am-u-end" id="end_price_div">
                                <input type="text" name="end_price" id="end_price" class="end_price" value=''   >
                            </div>

                        </div>
                        <hr/>
                        <div class="am-form-group">
                            <div class="am-u-sm-10 am-u-sm-push-2">
                                <button type="button" class="am-btn am-btn-primary" onclick="addQuote()">记录报价</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="__PUBLIC__/js/jquery.min.js"></script>
    <script src="__PUBLIC__/js/amazeui.min.js"></script>
    <script src="__PUBLIC__/js/app.js"></script>
    <script src="__PUBLIC__/js/plus.js"></script>
    <script src="__PUBLIC__/js/layer.js"></script>
    <script type="text/javascript">

        function addQuote(){
            // alert(66666);
            var customer_name = $.trim($("#customer_name").val()); 
            if(customer_name == '' ){
                layer.alert("请填写客户名称！", {icon: 5,});
                $("#customer_name").focus();
                exit;
            }

            var customer_level = $("#customer_level_discount").val();
            if(customer_level == '' ){
                layer.alert("请选择客户等级！", {icon: 5,});
                $("#customer_level_discount").focus();
                exit;
            }

            var linkman_name = $.trim($("#linkman_name").val());
            if(linkman_name == '' ){
                layer.alert("请填写联系人姓名！", {icon: 5,});
                $("#linkman_name").focus();
                exit;
            }

            var linkman_phone = $.trim($("#linkman_phone").val());
            if(linkman_phone == '' ){
                layer.alert("请填写联系人电话！", {icon: 5,});
                $("#linkman_phone").focus();
                exit;
            }

            var remark = $.trim($("#remark").val());

            // var product_type = $()
            product_type_yz();
            product_name_yz();
            product_model_yz();
            product_spec_yz();
            product_supplier_yz();

            var product_type_id = $("#product_type").val();
            var product_name_id = $("#product_name").val();
            var product_model_id = $("#hide_product_model_value").val();
            var product_supplier_id = $("#select_supplier_id").val();
            var product_supplier_name = $("#select_supplier_name").val();
            var product_num = $(".product_num").val();
            var product_spec_str = '';

            var post_parameter_value = $("#post_parameter_spec_value").val();
            var post_parameter_value_arr = post_parameter_value.split(",");
            if(post_parameter_value_arr != ''){
                for(var k in post_parameter_value_arr){
                    var post_parameter_arr = post_parameter_value_arr[k].split("-");

                    var product_spec_id = $("#hide_parameter_spec_value_"+post_parameter_arr[0]+"").val();
                    if(product_spec_id != ''){
                        product_spec_str = product_spec_str+product_spec_id+",";
                    }
                }
            }
            // alert(product_spec_str);

            var special_techmology_str = '';
            var hide_have_price_value = $("#hide_have_price_value").val();
            if(hide_have_price_value == 2){
                var special_techmology_arr = [];
                $('input[name=hide_special_technology_selected]').each(function() {
                    var value = $(this).val();
                    if(value != ''){
                        special_techmology_arr.push($(this).val());
                    }
                });
                var special_techmology_str = special_techmology_arr.join(',');
            }
            
            var hide_have_price_value_2 = $("#hide_have_price_value_2").val();
            var product_cost_price = $.trim($("#product_cost_price").val());
            if(hide_have_price_value_2 == 2){
                if(product_cost_price == ''){
                    layer.alert("请输入成本单价！", {icon: 5,});
                    $("#product_cost_price").focus();
                    exit;
                }
            }
            
            var product_discount_money = $("#hide_product_discount_money").val();

            var product_end_price_one = $.trim($("#end_product_price").val());
            if(product_end_price_one == '' ){
                layer.alert("请输入单价！", {icon: 5,}); 
                $("#end_product_price").focus();
                exit;
            }

            var product_end_price = $.trim($("#end_price").val());
            if(product_end_price == '' ){
                layer.alert("请输入最终价格！", {icon: 5,});
                $("#end_price").focus();
                exit;
            }

            //添加报价记录
            $.post("__APP__/Order/addQuoteInfo",{"customer_name":customer_name,"customer_level":customer_level,"linkman_name":linkman_name,"linkman_tel":linkman_phone,"remark":remark,"product_type_id":product_type_id,"product_name_id":product_name_id,"product_model_id":product_model_id,"product_spec_id_str":product_spec_str,"special_technologyh_id_str":special_techmology_str,"supplier_id":product_supplier_id,"supplier_name":product_supplier_name,"num":product_num,"discount_money":product_discount_money,"end_price":product_end_price_one,"end_money":product_end_price,"cost_price":product_cost_price},function(res){
                    if(res > 0 ){
                        parent.layer.msg('报价记录添加成功！', {icon: 1,});
                        parent.location.href='__APP__/Order/quote';
                        var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                        parent.layer.close(index);

                    }else{
                        parent.layer.alert('报价记录添加失败！请稍后重试！', {
                                                            icon: 5,
                                                            title:'提示',
                                                        });
                        return false;
                    }
            });


        }

        function getProductName(){
            var id = $("#product_type").val();
            var have_price = $("#hide_item_have_price_"+id).val();

            rand_info();

            if(id != 0 ){
                // //把判断该分类商品是否有报价的判断数据存入隐藏域中
                $("#hide_have_price_value_2").val(have_price);

                $.post("__APP__/Order/getProductNameByProductType",{"id":id},function(res){
                    $("#product_name").html('');
                    $("#product_name").html(res);
                })

            }else{
                var id = '';
                $.post("__APP__/Order/getProductNameInfoAll",{"id":id},function(res){
                    $("#product_name").html('');
                    $("#product_name").html(res);
                })
            }

            //根据分类ID判断该分类是否有特殊工艺
            $.post("__APP__/Order/getProductSpecialTechnology",{"id":id},function(res){
                $("#product_special_technology_div").html(' ');
                $("#product_special_technology_div").html(res);
            })

            //移除产品型号
            removeProductModel();
            //移除产品规格
            removeProductSpec();
            //移除原来的参考信息
            removeRrferInfo();
            //重新渲染参考价格
            removeDiscountMoney(); 


        }

        function getProductModel(){
            var id = $("#product_name").val();
            //验证是否选择了产品分类
            product_type_yz();

            //重新渲染与价格有关的信息
            rand_info();

            if( id != 0){
                //渲染产品型号信息
                $.post("__APP__/Order/getProductModelByProductName",{"id":id},function(res){
                    $("#product_model").html('');
                    $("#product_model").html(res);
                })
            }else{
                //移除产品型号
                removeProductModel();
            }

            //根据产品ID判断该产品是否有特殊工艺
            $.post("__APP__/Order/getProductSpecialTechnology",{"id":id},function(res){
                $("#product_special_technology_div").html(' ');
                $("#product_special_technology_div").html(res);
            })
            
            //移除产品规格
            removeProductSpec();

            //若该分类有价格，则重新渲染特殊工艺选项
            var hide_have_price_value = $("#hide_have_price_value").val();
            // alert(hide_have_price_value);
            if(hide_have_price_value == 2){
                $('li[name=product_special_technology]').removeClass("xg-product-btn-selected");
                //对该选项的隐藏域中的值移除
                $('input[name=hide_special_technology_selected]').val('');
            }

            //移除原来的参考信息
            removeRrferInfo();
            //重新渲染参考价格
            removeDiscountMoney(); 
        }

        function getProductSpec(id){
            //验证是否选择
            product_type_yz();

            $("#product_model_"+id).addClass("xg-product-btn-selected").siblings('li').removeClass("xg-product-btn-selected");

            $("#hide_product_model_value").val(id);

            //重新渲染与价格有关的信息
            rand_info();

            $.post("__APP__/Order/getProductSpecByProductModel",{"id":id},function(res){
                $(".product_paramerter").html('');
                $(".product_paramerter").html(res);
            })

            //若该分类有价格，则重新渲染特殊工艺选项
            var hide_have_price_value = $("#hide_have_price_value").val();
            if(hide_have_price_value == 2){
                $('li[name=product_special_technology]').removeClass("xg-product-btn-selected");
                //对该选项的隐藏域中的值移除
                $('input[name=hide_special_technology_selected]').val('');
            }
            //移除原来的参考信息
            removeRrferInfo();
            //重新渲染参考价格
            removeDiscountMoney(); 

        }

        //对显示或者选中的商品规格信息进行处理
        function selectProductSpec(spec_id,parameter_id){
            //验证是否选择了产品分类
            product_type_yz();

            $("#product_spec_"+spec_id).addClass("xg-product-btn-selected").siblings('li').removeClass("xg-product-btn-selected");
            //将选中的值放入对应的隐藏域中
            $("#hide_parameter_spec_value_"+parameter_id).val(spec_id);

            //重新渲染与价格有关的信息
            
            //若该分类没有价格，则重新渲染特殊工艺选项
            var hide_have_price_value = $("#hide_have_price_value").val();
            if(hide_have_price_value == 2){
                $('li[name=product_special_technology]').removeClass("xg-product-btn-selected");
                //对该选项的隐藏域中的值移除
                $('input[name=hide_special_technology_selected]').val('');
            }

            rand_info();

            //移除原来的参考信息
            removeRrferInfo();
            //重新渲染参考价格
            removeDiscountMoney(); 
        }

        function clickProductSpecialTechnology(id){
            //验证是否选择了产品分类
            product_type_yz();
            product_name_yz();
            product_model_yz();
            product_spec_yz();


            var selected_value = $("#hide_special_technology_selected_"+id).val();
            if(selected_value != ''){
                $("#product_special_technology_"+id).removeClass("xg-product-btn-selected");
                $("#hide_special_technology_selected_"+id).val('');

            }else{
                $("#product_special_technology_"+id).addClass("xg-product-btn-selected");
                $("#hide_special_technology_selected_"+id).val(id);
            }

            //移除原来的参考信息
            removeRrferInfo();
            //重新渲染参考价格
            removeDiscountMoney(); 
            
        }

        $('#selectSupplier').on('click', function(){
            //验证是否选择了产品分类
            product_type_yz();

            product_name_yz();
            product_model_yz();
            product_spec_yz();

            var product_type_id = $("#product_type").val();
            var product_name_id = $("#product_name").val();
            var product_model_id = $("#hide_product_model_value").val();
            var product_spec_str = '';

            var post_parameter_value = $("#post_parameter_spec_value").val();
            var post_parameter_value_arr = post_parameter_value.split(",");
            if(post_parameter_value_arr != ''){
                for(var k in post_parameter_value_arr){
                    var post_parameter_arr = post_parameter_value_arr[k].split("-");

                    var product_spec_id = $("#hide_parameter_spec_value_"+post_parameter_arr[0]+"").val();
                    if(product_spec_id != ''){
                        product_spec_str = product_spec_str+product_spec_id+",";
                    }
                }
            }
            // alert(product_spec_str);
            rand_info();

            var hide_have_price_value_2 = $("#hide_have_price_value_2").val();

            $.post("__APP__/Order/getProductSupplierInfo",{"have_price":hide_have_price_value_2,"product_type_id":product_type_id,"product_name_id":product_name_id,"product_model_id":product_model_id,"product_spec_str":product_spec_str},function(res){
                $("#select_supplier_group").html('');
                $("#select_supplier_group").html(res);

                $("#show_supplier").css("border","medium solid #03C");

                var condition_type = $("#condition_type").val();
                $("#condition_"+condition_type).addClass("am-btn-danger").siblings('button').removeClass("am-btn-danger");
            })

            //移除原来的参考信息
            // removeRrferInfo();
            //重新渲染参考价格
            removeDiscountMoney(); 

        });

        //对供应商信息列表进行条件筛选
        function conditionSelect(type){
            var product_type_id = $("#get_product_type_id").val();
            var product_name_id = $("#get_product_name_id").val();
            var product_model_id = $("#get_product_model_id").val();
            var product_spec_str = $("#get_product_spec_str").val();
            var have_price_value = $("#get_have_price").val();

            $.post("__APP__/Order/getProductSupplierInfo",{"type":type,"have_price":have_price_value,"product_type_id":product_type_id,"product_name_id":product_name_id,"product_model_id":product_model_id,"product_spec_str":product_spec_str},function(res){
                $("#select_supplier_group").html('');
                $("#select_supplier_group").html(res);

                $("#show_supplier").css("border","medium solid #03C");

                var condition_type = $("#condition_type").val();
                $("#condition_"+condition_type).addClass("am-btn-danger").siblings('button').removeClass("am-btn-danger");
            })
            
        }

        //点击供应商信息，把供应商ID和价格填到隐藏域中，并且显示在选择供应商按钮后面
        function clickSupplierInfo(supplier_id,supplier_name,price){

            var hide_have_price_value_2 = $("#hide_have_price_value_2").val();
            var price_value = '';

            if(hide_have_price_value_2 == 1 ){
                if(price == undefined){
                    var price_value = '';
                    var price_html = "<div class='am-u-sm-2'> <span style='font-size:18px;color:#f00;'>暂无价格</span> </div> <input type='hidden' value='"+price_value+"' id='product_cost_price' />";
                }else{
                    var price_value = price;
                    var price_html = "<div class='am-u-sm-2'> <span  style='font-size:18px;color: #f00;'> "+price+"元</span> </div>  <input type='hidden' value='"+price_value+"' id='product_cost_price' />";
                }
            }else{
                var price_html = "<div class='am-u-sm-2'> <input type='text' value='' id='product_cost_price' style='width:120px;'/> </div>";
            }


            //显示选择的供应商信息
            // var supplier_html = "<span  style='font-size:18px;''> "+supplier_name+"</span> &nbsp;&nbsp;&nbsp;&nbsp;";
            var html = "<div class='am-u-sm-5'> <span  style='font-size:18px;''> "+supplier_name+"</span> </div> &nbsp;&nbsp;&nbsp;&nbsp;  <div class='am-u-sm-2'> 成本单价：</div>  "+price_html+"  <input type='hidden' value='"+supplier_id+"' id='select_supplier_id' /> <input type='hidden' value='"+supplier_name+"' id='select_supplier_name' /> ";

            $('#product_supplier_select').html(' ');
            $('#product_supplier_select').html(html);

            //去除显示的供应商列表信息
            $('#select_supplier_group').html(' ');

            //移除原来的参考信息
            // removeRrferInfo();
            //重新渲染参考价格
            removeDiscountMoney(); 

        }

        function inputProductNum(){
            //对选项内容进行验证
            product_type_yz();
            product_name_yz();
            product_model_yz();
            product_spec_yz();
            product_supplier_yz();

            var hide_have_price_value_2 = $("#hide_have_price_value_2").val();
            if(hide_have_price_value_2 == 2){
                // product_technology();
                var have_price_cost_price = $("#product_cost_price").val();
                if(have_price_cost_price == ''){
                    layer.alert("请输入产品成本单价！", {icon: 5,});
                    $("#product_cost_price").focus();
                    exit;
                }
            }

            //移除原来的参考信息
            // removeRrferInfo();
            //重新渲染参考价格
            removeDiscountMoney(); 

        }

        function getOrderReferInfo(){

            product_type_yz();
            product_name_yz();
            product_model_yz();
            product_spec_yz();
            // product_supplier_yz();
            //移除原来的参考信息 order_refer_info_button
            removeRrferInfo();

            var product_type_id = $("#product_type").val();
            var product_name_id = $("#product_name").val();
            var product_model_id = $("#hide_product_model_value").val();
            var product_spec_str = '';

            var post_parameter_value = $("#post_parameter_spec_value").val();
            var post_parameter_value_arr = post_parameter_value.split(",");
            if(post_parameter_value_arr != ''){
                for(var k in post_parameter_value_arr){
                    var post_parameter_arr = post_parameter_value_arr[k].split("-");

                    var product_spec_id = $("#hide_parameter_spec_value_"+post_parameter_arr[0]+"").val();
                    if(product_spec_id != ''){
                        product_spec_str = product_spec_str+product_spec_id+",";
                    }
                }
            }
            // alert(product_spec_str);

            var product_supplier_id = $("#select_supplier_id").val();

            
            //获取参考信息
            $.post("__APP__/Order/getOrderReferInfo",{"product_type_id":product_type_id,"product_name_id":product_name_id,"product_model_id":product_model_id,"product_spec_str":product_spec_str,"product_supplier_id":product_supplier_id},function(res){
                    $("#order_refer_info_button").after(res);
            })

        }


        //商品参考报价
        function getOrderReferInfoMoney(){
            var customer_level_discount = $("#customer_level_discount").val();
            if(customer_level_discount == ''){
                layer.alert("请选择客户等级！", {icon: 5,});
                    $("#customer_level_discount").focus();
                    exit;
            }

            product_type_yz();
            product_name_yz();
            product_model_yz();
            product_spec_yz();
            product_supplier_yz();

            // var customer_id = $("#customer_id").val();
            var product_num = $(".product_num").val();

            //若该商品没有填写报价，则该处取该商品的成本单价为0
            var hide_have_price_value_2 = $("#hide_have_price_value_2").val();
            var product_cost_price = $.trim($("#product_cost_price").val());
            // alert(hide_have_price_value);
            if(hide_have_price_value_2 == 2){
                if(product_cost_price == '' ){
                    layer.alert("请填写成本单价！", {icon: 5,});
                    $("#product_cost_price").focus();
                    exit;
                }
            }else{
                if(product_cost_price == '' ){
                    product_cost_price = 0;
                }
            }

            //获取参考报价信息
            $.post("__APP__/Order/getOrderReferInfoMoney",{"customer_level":customer_level_discount,"product_num":product_num,"product_cost_price":product_cost_price},function(res){
                    $('#order_refer_info_money_button').html(' ');
                    $('#order_refer_info_money_button').html(res);
                    // $("#order_refer_info_money_button").after(res);
                    // $("#history_order").html(res); 
            })

        }


        //对选项内容进行验证
        function product_type_yz(){
            var product_type = $("#product_type").val();
            if(product_type == ''){
                layer.alert("请选择产品分类！", {icon: 5,});
                $("#product_type").focus();
                //重新对商品名称的内容进行渲染
                var id = '';
                $.post("__APP__/Order/getProductNameInfoAll",{"id":id},function(res){
                    $("#product_name").html('');
                    $("#product_name").html(res);
                })
                exit;
            }
        }

        function product_name_yz(){
            var product_name = $("#product_name").val();
            if(product_name == ''){
                layer.alert("请选择产品名称！", {icon: 5,});
                $("#product_name").focus();
                exit;
            }
        }
        function product_model_yz(){
            var product_model = $("#hide_product_model_value").val();
            if(product_model == ''){
                layer.alert("请选择产品型号！", {icon: 5,});
                $("#product_model").focus();
                exit;
            }
        }
        function product_spec_yz(){
            var post_parameter_value = $("#post_parameter_spec_value").val();

            var post_parameter_value_arr = post_parameter_value.split(",");
            if(post_parameter_value_arr != ''){
                for(var k in post_parameter_value_arr){
                    var post_parameter_arr = post_parameter_value_arr[k].split("-");

                    var product_spec = $("#hide_parameter_spec_value_"+post_parameter_arr[0]+"").val();
                    var product_paramerter_name = post_parameter_arr[1];
                    if(product_spec == ''){
                        layer.alert("请选择"+product_paramerter_name+"！", {icon: 5,});
                        exit;
                    }
                }
            }else{
                layer.alert("请添加产品规格信息！", {icon: 5,});
                exit;
            }
        }
        function product_technology(){
            var hide_have_price_value = $("#hide_have_price_value").val();
            if(hide_have_price_value == 2){
                var aa = [];
                $('input[name=hide_special_technology_selected]').each(function() {
                    var value = $(this).val();
                    if(value != ''){
                        aa.push($(this).val());
                    }
                });
                if(aa.length == 0){
                    layer.alert('请选择工艺！');
                    return false;
                }
            }
        }
        function product_supplier_yz(){
            var product_supplier = $("#select_supplier_id").val();
            if(product_supplier == ''){
                layer.alert("请选择供应商！", {icon: 5,});
                $(".product_supplier").focus();
                exit;
            }
        }

        function removeProductModel(){
            var html = "<span style='color: #f00;'>请先选择产品！</span>";
            $("#product_model").html(' ');
            $("#product_model").html(html);
        }
        function removeProductSpec(){
            var html = "<div class='am-form-group'> <label for='contact-department' class='am-u-sm-2 am-form-label'>产品规格：</label> <div class='am-u-sm-8 am-u-end'> <ul> <li value='1'> <span style='color: #f00;'>请先选择产品型号！</span> </li> </ul> </div> </div> <input type='hidden' value='' id='post_parameter_spec_value' />";
            $(".product_paramerter").html(' ');
            $(".product_paramerter").html(html);
        }
        //移除原来的参考信息
        function removeRrferInfo(){
            $('div[name=refer_history_order_div]').remove();
            $('div[name=refer_history_quote_div]').remove();
            $('div[name=refer_product_discount_money_div]').remove();
        }

        //重新渲染与价格有关的信息
        function rand_info(){
            //重新渲染与价格有关的信息
            //供应商及产品单价
            var supplier_price_html = "<span style='color: #f00;margin-left:20px;'>请先选择产品信息！</span> <input type='hidden' value='' id='select_supplier_id' /> </span> <input type='hidden' value='' id='select_supplier_name' /> <input type='hidden' value='' id='product_cost_price' />";
            $("#product_supplier_select").html(' ');
            $("#product_supplier_select").html(supplier_price_html);
            //供应商信息列表
            $("#select_supplier_group").html('');

            //数量
            $(".product_num").val('1');
            //历史订单
            var history_order_html = "<div class='am-u-sm-10'> <b style='color: #f00;'>请选择产品信息！</b> </div>";
            $('#history_order').html(' ');
            $('#history_order').html(history_order_html); 
            //历史报价记录
            var history_price_record_html = "";
            //客户参考价
            var customer_discount_money_html = "<span style='color: #f00;'>请选选择产品信息和数量！</span>";
            $('#product_discount_money_div').html(' ');
            $('#product_discount_money_div').html(customer_discount_money_html); 
            //最终输入价格
            $(".end_price").val(' '); 
        }

        function removeDiscountMoney(){
            var html = " <input type='hidden' value='' id='hide_product_discount_money' />";
            $("#order_refer_info_money_button").html(' ');
            $("#order_refer_info_money_button").html(html);

        }

    </script>

    <script type="text/javascript">
        var inputWidth = $(".xg-quote-customer").width();
        var menuWidth = inputWidth;
        $(".xg-search-menu").width(menuWidth);
        function finds(){
            var search_value = $.trim($("#customer_name").val());
            // alert(search_value);exit;
            if(search_value.length >= 1){
                $.post("__APP__/Order/searchCustomerInfo",{"search_value":search_value},function(res){
                    $(".searchmore").empty();//清空原来的ul
                    if(res != ""){
                        $(".searchmore").html(res);;

                        $(".searchmore").show();
                    }else{
                        $(".searchmore").hide();
                    }
                })
            }else{
                $(".searchmore").hide();
            }

            $(document).on("click", ".searchmore li", function(){
                $("#customer_name").val(trim($(this).text()));
                $(".searchmore").hide();
            });

        }

        function searchCustomerName(customer_name){
            $("#customer_name").val(customer_name);
            $(".searchmore").empty();//清空原来的ul
            $(".searchmore").hide();
            //替换原来的客户等级的下拉选择
            if(customer_name.length >= 1){
                $.post("__APP__/Order/searchCustomerInfoIsHaveLevel",{"customer_name":customer_name},function(res){
                    $("#customer_level_div").html(res);;
                })
            }
            //替换原来的客户等级的下拉选择
            if(customer_name.length >= 1){
                $.post("__APP__/Order/searchCustomerInfoIsHavelLinkman",{"customer_name":customer_name},function(res){
                    $("#linkman_name_div").html(res);;
                    
                })
            }
        }

        function getLxrByCustomerId(){
            var lxr_id = $("#linkman_name").val();

            $.post("__APP__/Order/getTelByLxrId",{"lxr_id":lxr_id},function(res){
                var data = eval("(" + res + ")");
                $("#linkman_phone").val(data.phone);
            })
        }
    </script>
    <script type="text/javascript">
        $(function(){
            $("#customer_name").blur(function(){
                $(".searchmore").hide();
                var customer_name = $.trim($("#customer_name").val());
                if(customer_name.length >= 1){
                    $.post("__APP__/Order/searchCustomerInfoIsHaveLevel",{"customer_name":customer_name},function(res){
                        //替换原来的客户等级的下拉选择
                        $("#customer_level_div").html(res);;
                        
                    })
                }

                //替换原来的客户等级的下拉选择
                if(customer_name.length >= 1){
                    $.post("__APP__/Order/searchCustomerInfoIsHavelLinkman",{"customer_name":customer_name},function(res){
                        $("#linkman_name_div").html(res);;
                        
                    })
                }

                
            }); 
        })

    </script>

</body>

</html>